<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SportMonks Explorer — GUI Output</title>
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            margin: 20px;
            background: #f7f7f7;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 18px;
            align-items: start;
        }

        .card {
            background: #fff;
            border: 1px solid #e6e6e6;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.03);
        }

        .list {
            max-height: 480px;
            overflow: auto;
            padding-right: 6px;
        }

        .section-title {
            font-weight: 600;
            margin: 8px 0;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 6px 0;
        }

        button {
            background: #0b74ff;
            color: #fff;
            border: none;
            padding: 10px 12px;
            border-radius: 7px;
            cursor: pointer;
        }

        button.secondary {
            background: #f1f1f1;
            color: #111;
        }

        .small {
            font-size: 13px;
            color: #666;
        }

        input[type="text"] {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .results {
            margin-top: 12px;
        }

        .meta {
            font-size: 12px;
            color: #777;
            margin-bottom: 8px;
        }

        pre {
            background: #0f1724;
            color: #e6eef8;
            padding: 12px;
            border-radius: 6px;
            max-height: 280px;
            overflow: auto;
        }

        .gui-output {
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 6px;
            background: #f9f9f9;
            margin-bottom: 12px;
        }

        .gui-output h4 {
            margin: 0 0 6px 0;
            font-size: 14px;
        }

        .gui-output p {
            margin: 2px 0;
            font-size: 13px;
        }

        ol {
            padding-left: 18px;
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>SportMonks Explorer — GUI Output</h1>
        <p class="small">Select a resource, optional includes, and enter IDs, dates, or date ranges. Errors are
            displayed
            clearly.</p>

        <div class="grid">
            <!-- Left: Selection -->
            <div class="card">
                <div class="input-row">
                    <input id="identifierInput" type="text"
                        placeholder="ID, Search, or Date YYYY-MM-DD / Date Range YYYY-MM-DD,YYYY-MM-DD" />
                    <button id="openModalBtn">Selector</button>
                </div>

                <div id="selectorContainer" class="list">
                    <div class="section-title">Resources</div>
                    <div id="resourcesList"></div>

                    <div class="section-title">Includes / Fields</div>
                    <div id="includesList"></div>
                </div>

                <div style="margin-top:12px; display:flex; gap:8px;">
                    <button id="sendBtn">Send Request</button>
                    <button id="previewBtn" class="secondary">Preview</button>
                    <button id="clearHistoryBtn" class="secondary">Clear</button>
                </div>

                <div class="results">
                    <div class="meta">GUI Output</div>
                    <div id="guiOutput" class="gui-output">No request yet</div>
                    <div class="meta">Raw JSON (click to toggle)</div>
                    <pre id="lastResponse">No request yet</pre>
                </div>
            </div>

            <!-- Right: History + Quick picks -->
            <div>
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <strong>History</strong>
                        <small class="small">Selections & responses</small>
                    </div>
                    <div style="margin-top:10px;">
                        <ol id="historyList"></ol>
                    </div>
                </div>

                <div style="height:12px"></div>

                <div class="card">
                    <strong>Quick picks</strong>
                    <p class="small">Common queries</p>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
                        <button class="secondary"
                            data-quick='{"resource":"fixtures","includes":["sport","scores"],"identifier":"2024-02-16"}'>Fixtures
                            by Date</button>
                        <button class="secondary"
                            data-quick='{"resource":"fixtures","includes":["sport","statistics","odds"],"identifier":"2024-02-25,2024-02-29"}'>Fixtures
                            by Date Range</button>
                        <button class="secondary" data-quick='{"resource":"continents","includes":["countries"]}'>All
                            Continents</button>
                        <button class="secondary"
                            data-quick='{"resource":"standings","includes":["form","league","season","stage","group","participant"],"identifier":""}'>Standings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const resources = [
            "continents", "countries", "regions", "cities", "types", "my", "livescores",
            "fixtures", "news", "leagues", "schedules", "seasons", "teams", "commentaries",
            "referees", "standings", "players", "stages", "coaches", "topscorers", "rivals",
            "venues", "rounds", "pre-match-odds", "inplay-odds", "squads", "tv-stations",
            "predictions", "transfers", "states"
        ];

        const includes = [
            "sidelined", "formations", "ballCoordinates", "sport", "round", "stage", "group",
            "aggregate", "league", "season", "referees", "coaches", "tvStations", "venue", "state",
            "weatherReport", "lineups", "events", "timeline", "comments", "trends", "statistics",
            "periods", "participants", "odds", "inplayOdds", "prematchNews", "metadata",
            "predictions", "scores", "form", "rule", "details"
        ];

        function buildList(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            items.forEach(item => {
                const id = `${containerId}_${item.replace(/[^a-z0-9]/gi, '_')}`;
                const row = document.createElement('div');
                row.className = 'checkbox-row';
                row.innerHTML = `<input type="checkbox" id="${id}" value="${item}"><label for="${id}">${item}</label>`;
                container.appendChild(row);
            });
        }

        buildList('resourcesList', resources);
        buildList('includesList', includes);

        let historyData = [];
        function addToHistory(requestObj, responseObj) {
            const now = new Date();
            const entry = { time: now.toISOString(), request: requestObj, response: responseObj };
            historyData.unshift(entry);
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            historyData.forEach(h => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${h.request.resource}</strong> — <small>${new Date(h.time).toLocaleString()}</small>`;
                li.style.marginBottom = '8px';
                li.addEventListener('click', () => {
                    displayGUI(h.response);
                    document.getElementById('lastResponse').textContent = JSON.stringify(h.response, null, 2);
                });
                list.appendChild(li);
            });
        }

        function collectSelection() {
            const selectedResource = Array.from(document.querySelectorAll('#resourcesList input:checked')).map(i => i.value)[0] || null;
            const selectedIncludes = Array.from(document.querySelectorAll('#includesList input:checked')).map(i => i.value);
            const identifier = document.getElementById('identifierInput').value.trim();
            return { resource: selectedResource, includes: selectedIncludes, identifier: identifier || null };
        }

        function displayGUI(data) {
            const gui = document.getElementById('guiOutput');
            if (!data) {
                gui.innerHTML = 'No data';
                return;
            }
            if (data.errors || data.message) {
                gui.innerHTML = `<h4>Error:</h4>
                    <p>${data.message || JSON.stringify(data.errors)}</p>
                    ${data.link ? `<p>More info: <a href="${data.link}" target="_blank">${data.link}</a></p>` : ''}
                    <p>Code: ${data.code || ''}</p>`;
            } else if (data.data) {
                // simple GUI for arrays or objects
                if (Array.isArray(data.data)) {
                    gui.innerHTML = data.data.slice(0, 10).map(d => `<div><strong>${d.id || d.name || d.league?.name || d.sport?.name || 'Item'}</strong></div>`).join('');
                } else {
                    gui.innerHTML = `<div><strong>${data.data.id || data.data.name || 'Result'}</strong></div>`;
                }
            } else {
                gui.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
        }

        document.getElementById('previewBtn').addEventListener('click', () => {
            const sel = collectSelection();
            console.log("Preview:", sel);
            alert("Preview:\n" + JSON.stringify(sel, null, 2));
        });

        document.getElementById('clearHistoryBtn').addEventListener('click', () => {
            if (!confirm('Clear history?')) return;
            historyData = [];
            renderHistory();
            document.getElementById('lastResponse').textContent = 'No request yet';
            document.getElementById('guiOutput').textContent = 'No request yet';
        });

        document.getElementById('sendBtn').addEventListener('click', async () => {
            const selection = collectSelection();
            if (!selection.resource) {
                alert('Select a resource.');
                return;
            }

            let endpointType = "list";
            let dateFrom = null, dateTo = null;

            if (selection.resource === "fixtures") {
                if (/^\d{4}-\d{2}-\d{2}$/.test(selection.identifier)) {
                    endpointType = "byDate";
                } else if (/^\d{4}-\d{2}-\d{2},\d{4}-\d{2}-\d{2}$/.test(selection.identifier)) {
                    endpointType = "between";
                    [dateFrom, dateTo] = selection.identifier.split(",");
                } else if (/^\d+$/.test(selection.identifier)) {
                    endpointType = "byID";
                }
            } else if (/^\d+$/.test(selection.identifier)) {
                endpointType = "byID";
            }

            const payload = { resource: selection.resource, endpointType, identifier: selection.identifier, dateFrom, dateTo, includes: selection.includes, params: {} };

            document.getElementById('guiOutput').textContent = 'Requesting...';
            document.getElementById('lastResponse').textContent = 'Requesting...';

            try {
                const res = await fetch('sportmonks_request.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error('Network not ok ' + res.status);
                const data = await res.json();
                addToHistory(payload, data);
                displayGUI(data);
                document.getElementById('lastResponse').textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                console.error('Request failed:', err);
                document.getElementById('guiOutput').innerHTML = `<h4>Error:</h4><p>${err}</p>`;
                document.getElementById('lastResponse').textContent = 'Request failed: ' + String(err);
            }
        });

        document.querySelectorAll('[data-quick]').forEach(btn => {
            btn.addEventListener('click', () => {
                const q = JSON.parse(btn.getAttribute('data-quick'));
                document.querySelectorAll('#resourcesList input').forEach(i => i.checked = (i.value === q.resource));
                document.querySelectorAll('#includesList input').forEach(i => i.checked = q.includes && q.includes.includes(i.value));
                document.getElementById('identifierInput').value = q.identifier || '';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        document.getElementById('openModalBtn').addEventListener('click', () => {
            alert('Page UI used as selector. Modal version can be added.');
        });
    </script>
</body>

</html>